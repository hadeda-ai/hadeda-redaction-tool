(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{125:function(e,t){},126:function(e,t){},131:function(e,t,a){e.exports=a(153)},152:function(e,t,a){},153:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(44),l=a.n(i),o=(a(136),a(21)),c=a(129),s=a(52),u=a(19),d=a(10),m=a(110),v=a(111),p=a(88),f=a.n(p),E=new(function(){function e(){Object(m.a)(this,e)}return Object(v.a)(e,[{key:"getProfile",value:function(){return f()(this.getToken())}},{key:"loggedIn",value:function(){var e=this.getToken();return!!e&&!this.isTokenExpired(e)}},{key:"isTokenExpired",value:function(e){try{return f()(e).exp<Date.now()/1e3}catch(t){return!1}}},{key:"getToken",value:function(){return localStorage.getItem("id_token")}},{key:"login",value:function(e){localStorage.setItem("id_token",e),window.location.assign("/")}},{key:"logout",value:function(){localStorage.removeItem("id_token"),window.location.assign("/")}}]),e}()),h=a(166),b=a(165),g=a(163),k=a(167),y=a(16),O=a.n(y),M=a(24),w=a(54),j=a(12),_=a(164),x=a(156),N=a(157),I=a(46),S=a(25),C=a.n(S);function D(){var e=Object(I.a)(["\n    mutation dislikeMovie($movieId: ID!) {\n        dislikeMovie(movieId: $movieId) {\n            likedMovies {\n                _id\n                externalMovieId\n                title\n                overview\n                releaseDate\n                rating\n                voteCount\n                poster\n                trailer\n            }\n            dislikedMovies{\n                _id\n                externalMovieId\n                title\n                overview\n                releaseDate\n                rating\n                voteCount\n                poster\n                trailer\n            }\n        }\n    }\n"]);return D=function(){return e},e}function T(){var e=Object(I.a)(["\n    mutation likeMovie($movieId: ID!) {\n        likeMovie(movieId: $movieId) {\n            likedMovies {\n                _id\n                externalMovieId\n                title\n                overview\n                releaseDate\n                rating\n                voteCount\n                poster\n                trailer\n            }\n            dislikedMovies{\n                _id\n                externalMovieId\n                title\n                overview\n                releaseDate\n                rating\n                voteCount\n                poster\n                trailer\n            }\n        }\n    }\n"]);return T=function(){return e},e}function P(){var e=Object(I.a)(["\n    mutation addMovie($input: MovieInput!) {\n        addMovie(input:$input) {\n            _id\n            externalMovieId\n            title\n            overview\n            releaseDate\n            rating\n            voteCount\n            poster\n            trailer\n            likedUsers {\n                _id\n                username\n            }\n            dislikedUsers {\n                _id\n                username\n            }\n        }\n    }\n"]);return P=function(){return e},e}function A(){var e=Object(I.a)(["\n    mutation login($email: String!, $password: String!) {\n        login(email: $email, password: $password) {\n            token\n            user {\n                _id\n                username\n                email\n                likedMovies {\n                    _id\n                    externalMovieId\n                    title\n                    overview\n                    releaseDate\n                    rating\n                    voteCount\n                    poster\n                    trailer\n                }\n                dislikedMovies{\n                    _id\n                    externalMovieId\n                    title\n                    overview\n                    releaseDate\n                    rating\n                    voteCount\n                    poster\n                    trailer\n                }\n            }\n        }\n    }\n"]);return A=function(){return e},e}function L(){var e=Object(I.a)(["\n    mutation addUser($username: String!, $email: String!, $password: String!) {\n        addUser(username: $username, email: $email, password: $password) {\n            token\n            user {\n                _id\n                username\n                email\n            }\n        }\n    }\n"]);return L=function(){return e},e}var F=C()(L()),q=C()(A()),U=C()(P()),R=C()(T()),V=C()(D()),K=function(){var e=Object(o.useMutation)(F),t=Object(d.a)(e,2),a=t[0],i=t[1].error,l=Object(n.useState)({username:"",email:"",password:""}),c=Object(d.a)(l,2),s=c[0],u=c[1],m=Object(n.useState)(!1),v=Object(d.a)(m,1)[0],p=Object(n.useState)(!1),f=Object(d.a)(p,2),h=f[0],b=f[1],g=function(e){var t=e.target,a=t.name,n=t.value;u(Object(j.a)(Object(j.a)({},s),{},Object(w.a)({},a,n)))},k=function(){var e=Object(M.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),!1===t.currentTarget.checkValidity()&&(t.preventDefault(),t.stopPropagation()),e.prev=3,e.next=6,a({variables:Object(j.a)({},s)});case 6:n=e.sent,r=n.data,E.login(r.addUser.token),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),console.error(e.t0),b(!0);case 15:u({username:"",email:"",password:""});case 16:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{noValidate:!0,validated:v,onSubmit:k},r.a.createElement(x.a,{dismissible:!0,onClose:function(){return b(!1)},show:h,variant:"danger"},"Something went wrong with your signup!"),r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Label,{htmlFor:"username"},"Username"),r.a.createElement(_.a.Control,{type:"text",placeholder:"Your username",name:"username",onChange:g,value:s.username,required:!0}),r.a.createElement(_.a.Control.Feedback,{type:"invalid"},"Username is required!")),r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Label,{htmlFor:"email"},"Email"),r.a.createElement(_.a.Control,{type:"email",placeholder:"Your email address",name:"email",onChange:g,value:s.email,required:!0}),r.a.createElement(_.a.Control.Feedback,{type:"invalid"},"Email is required!")),r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Label,{htmlFor:"password"},"Password"),r.a.createElement(_.a.Control,{type:"password",placeholder:"Your password",name:"password",onChange:g,value:s.password,required:!0}),r.a.createElement(_.a.Control.Feedback,{type:"invalid"},"Password is required!")),r.a.createElement(N.a,{disabled:!(s.username&&s.email&&s.password),type:"submit",variant:"success"},"Submit"),i&&r.a.createElement("div",null,"Sign up failed")))},$=function(){var e=Object(o.useMutation)(q),t=Object(d.a)(e,2),a=t[0],i=t[1].error,l=Object(n.useState)({email:"",password:""}),c=Object(d.a)(l,2),s=c[0],u=c[1],m=Object(n.useState)(!1),v=Object(d.a)(m,1)[0],p=Object(n.useState)(!1),f=Object(d.a)(p,2),h=f[0],b=f[1],g=function(e){var t=e.target,a=t.name,n=t.value;u(Object(j.a)(Object(j.a)({},s),{},Object(w.a)({},a,n)))},k=function(){var e=Object(M.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),!1===t.currentTarget.checkValidity()&&(t.preventDefault(),t.stopPropagation()),e.prev=3,e.next=6,a({variables:Object(j.a)({},s)});case 6:n=e.sent,r=n.data,E.login(r.login.token),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(3),console.error(e.t0),b(!0);case 15:u({username:"",email:"",password:""});case 16:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{noValidate:!0,validated:v,onSubmit:k},r.a.createElement(x.a,{dismissible:!0,onClose:function(){return b(!1)},show:h,variant:"danger"},"Something went wrong with your login credentials!"),r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Label,{htmlFor:"email"},"Email"),r.a.createElement(_.a.Control,{type:"text",placeholder:"Your email",name:"email",onChange:g,value:s.email,required:!0}),r.a.createElement(_.a.Control.Feedback,{type:"invalid"},"Email is required!")),r.a.createElement(_.a.Group,null,r.a.createElement(_.a.Label,{htmlFor:"password"},"Password"),r.a.createElement(_.a.Control,{type:"password",placeholder:"Your password",name:"password",onChange:g,value:s.password,required:!0}),r.a.createElement(_.a.Control.Feedback,{type:"invalid"},"Password is required!")),r.a.createElement(N.a,{disabled:!(s.email&&s.password),type:"submit",variant:"success"},"Submit"),i&&r.a.createElement("div",null,"Login failed")))},B=function(){var e=Object(n.useState)(!1),t=Object(d.a)(e,2),a=t[0],i=t[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,{collapseOnSelect:!0,expand:"lg",bg:"black",variant:"dark"},r.a.createElement(h.a.Brand,{as:s.b,to:"/"},"FANTINDER"),r.a.createElement(h.a.Toggle,{"aria-controls":"navbar"}),r.a.createElement(h.a.Collapse,{id:"navbar"},r.a.createElement(b.a,{className:"ml-auto"},r.a.createElement(b.a.Link,{as:s.b,to:"/search"},"Search For Movies"),r.a.createElement(b.a.Link,{as:s.b,to:"/checkout"},"Donation"),E.loggedIn()?r.a.createElement(r.a.Fragment,null,r.a.createElement(b.a.Link,{as:s.b,to:"/saved"},"Saved Movies"),r.a.createElement(b.a.Link,{onClick:E.logout},"Logout")):r.a.createElement(b.a.Link,{onClick:function(){return i(!0)}},"Login/Sign Up")))),r.a.createElement(g.a,{size:"lg",show:a,onHide:function(){return i(!1)},"aria-labelledby":"signup-modal"},r.a.createElement(k.a.Container,{defaultActiveKey:"login"},r.a.createElement(g.a.Header,{closeButton:!0},r.a.createElement(g.a.Title,{id:"signup-modal"},r.a.createElement(b.a,{variant:"pills"},r.a.createElement(b.a.Item,null,r.a.createElement(b.a.Link,{eventKey:"login"},"Login")),r.a.createElement(b.a.Item,null,r.a.createElement(b.a.Link,{eventKey:"signup"},"Sign Up"))))),r.a.createElement(g.a.Body,null,r.a.createElement(k.a.Content,null,r.a.createElement(k.a.Pane,{eventKey:"login"},r.a.createElement($,{handleModalClose:function(){return i(!1)}})),r.a.createElement(k.a.Pane,{eventKey:"signup"},r.a.createElement(K,{handleModalClose:function(){return i(!1)}})))))))},H=a(160),W=a(161),G=a(58),Y=a(168),z=a(169),J=a(158),Q=a(159),X=a(113),Z=a(121),ee=a.n(Z),te=a(81),ae=a(130),ne=a(83),re=function(e,t){switch(t.type){case"ADD_TO_MOVIES":return Object(j.a)(Object(j.a)({},e),{},{movies:[].concat(Object(ne.a)(e.movies),[t.movie])});case"ADD_TO_LIKED_MOVIES":return Object(j.a)(Object(j.a)({},e),{},{likedMovies:[].concat(Object(ne.a)(e.likedMovies),[t.movie]),dislikedMovies:1===e.dislikedMovies.length?[]:e.dislikedMovies.filter((function(e){return e._id!==t.movie._id}))});case"ADD_TO_DISLIKED_MOVIES":return Object(j.a)(Object(j.a)({},e),{},{likedMovies:1===e.likedMovies.length?[]:e.likedMovies.filter((function(e){return e._id!==t.movie._id})),dislikedMovies:[].concat(Object(ne.a)(e.dislikedMovies),[t.movie])});case"UPDATE_MOVIES":return Object(j.a)(Object(j.a)({},e),{},{movies:t.movies});case"UPDATE_MOVIE_PREFERENCES":return Object(j.a)(Object(j.a)({},e),{},{dislikedMovies:t.dislikedMovies,likedMovies:t.likedMovies});default:return e||""}};var ie=Object(n.createContext)(),le=ie.Provider,oe=function(e){e.value;var t,a=Object(ae.a)(e,["value"]),i=(t={likedMovies:[],dislikedMovies:[],movies:[]},Object(n.useReducer)(re,t)),l=Object(d.a)(i,2),o=l[0],c=l[1];return r.a.createElement(le,Object.assign({value:[o,c]},a))},ce=function(){return Object(n.useContext)(ie)},se=function(e){var t,a=ce(),i=Object(d.a)(a,1)[0],l=i.likedMovies,o=i.dislikedMovies,c=e.movie,s=e.displayTrailer,u=e.likeMovieHandler,m=e.dislikeMovieHandler,v=e.skipMovieHandler,p=e.displaySkip;function f(e){var t=e.eventKey,a=e.callback,i=Object(n.useContext)(G.a),l=Object(te.b)(t,(function(){return a&&a(t)})),o=i===t;return r.a.createElement(N.a,{variant:"link",className:"link ".concat(o?"text-muted":""),onClick:l},o?r.a.createElement("span",{className:"small"},"Collapse ",r.a.createElement("i",{className:"fas fa-chevron-up"})):r.a.createElement("span",{className:"small"},"Click for details ",r.a.createElement("i",{className:"fas fa-chevron-down"})))}return c?r.a.createElement(Y.a,null,r.a.createElement(z.a,null,s&&c.trailer?r.a.createElement(J.a,{aspectRatio:"16by9"},r.a.createElement("iframe",{title:c._id,width:"560",height:"315",src:c.trailer,frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})):c.poster&&r.a.createElement(z.a.Img,{src:c.poster,alt:"The cover for ".concat(c.title),variant:"top"}),r.a.createElement(z.a.Body,null,r.a.createElement(z.a.Title,null,c.title),r.a.createElement(Q.a,null,r.a.createElement(X.a,{sm:6},c.rating>=0?r.a.createElement(ee.a,{rating:c.rating/2,numberOfStars:5,name:"".concat(c._id,"-rating"),starDimension:"20px",starSpacing:"1px"}):null,r.a.createElement(z.a.Text,{className:"small"},"(",null===(t=c.voteCount)||void 0===t?void 0:t.toLocaleString()," ratings)")),r.a.createElement(X.a,{className:"text-right"},r.a.createElement(f,{eventKey:c._id})))),r.a.createElement(Y.a.Collapse,{eventKey:c._id},r.a.createElement(z.a.Body,null,r.a.createElement(z.a.Text,null,"Plot Summary"),r.a.createElement(z.a.Text,{className:"small"},c.overview),r.a.createElement(z.a.Text,{className:"small"},"Release Date: ",c.releaseDate),r.a.createElement(z.a.Text,{className:"small"},"".concat(c.likedUsers.length," users liked this movie")))),E.loggedIn()?r.a.createElement(z.a.Footer,{className:"d-flex justify-content-between"},r.a.createElement(N.a,{className:"movie-card-button",disabled:null===o||void 0===o?void 0:o.some((function(e){return e._id===c._id})),variant:(null===o||void 0===o?void 0:o.some((function(e){return e._id===c._id})))?"outline-secondary":"outline-danger",onClick:function(){return m(c)}},(null===o||void 0===o?void 0:o.some((function(e){return e._id===c._id})))?r.a.createElement("span",null,"Disliked!"):r.a.createElement("i",{className:"far fa-thumbs-down fa-2x"})),r.a.createElement(N.a,{className:"movie-card-button",disabled:null===l||void 0===l?void 0:l.some((function(e){return e._id===c._id})),variant:(null===l||void 0===l?void 0:l.some((function(e){return e._id===c._id})))?"outline-secondary":"outline-success",onClick:function(){return u(c)}},(null===l||void 0===l?void 0:l.some((function(e){return e._id===c._id})))?r.a.createElement("span",null,"Liked!"):r.a.createElement("i",{className:"far fa-thumbs-up fa-2x"}))):p&&r.a.createElement(z.a.Footer,{className:"text-center"},r.a.createElement(N.a,{className:"movie-card-button",size:"lg",onClick:v},"Next Movie")))):null};function ue(){var e=Object(I.a)(["\n  {\n    me {\n      _id\n      username\n      email\n      friends {\n        _id\n      }\n      likedMovies{\n        _id\n        externalMovieId\n        rating\n        voteCount\n        title\n        overview\n        releaseDate\n        poster\n        trailer\n        likedUsers {\n          _id\n          username\n        }\n        dislikedUsers {\n          _id\n          username\n        }\n      }\n      dislikedMovies{\n        _id\n        externalMovieId\n        rating\n        voteCount\n        title\n        overview\n        releaseDate\n        poster\n        trailer\n        likedUsers {\n          _id\n          username\n        }\n        dislikedUsers {\n          _id\n          username\n        }\n      }\n    }\n  }\n"]);return ue=function(){return e},e}var de=C()(ue());function me(e,t,a){return new Promise((function(n,r){var i,l,o,c=window.indexedDB.open("fantinder",1);c.onupgradeneeded=function(e){var t=c.result;t.createObjectStore("dislikedMovies",{keyPath:"_id"}),t.createObjectStore("likedMovies",{keyPath:"_id"}),t.createObjectStore("movies",{keyPath:"_id"})},c.onerror=function(e){console.log("There was an error")},c.onsuccess=function(r){switch(i=c.result,l=i.transaction(e,"readwrite"),o=l.objectStore(e),i.onerror=function(e){console.log("error",e)},t){case"put":o.put(a),n(a);break;case"get":var s=o.getAll();s.onsuccess=function(){n(s.result)};break;case"delete":o.delete(a._id);break;default:console.log("No valid method")}l.oncomplete=function(){i.close()}}}))}var ve=a(122),pe=a.n(ve),fe=function(){var e=Object(M.a)(O.a.mark((function e(t){var a,n,r,i,l,o,c,s,u;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.filter((function(e){return e.poster_path&&e.overview})),n=0;case 2:if(!(n<a.length)){e.next=34;break}return e.next=5,a[n];case 5:return r=e.sent,i={externalMovieId:r.id,rating:r.vote_average,voteCount:r.vote_count,title:r.title,overview:r.overview,releaseDate:pe()(r.release).format("LL"),poster:"https://image.tmdb.org/t/p/w500"+r.poster_path},e.prev=7,e.next=10,d=r.id,fetch("https://api.themoviedb.org/3/movie/".concat(d,"/videos?api_key=d64da0474db9594724886e71c0d202f1&language=en-US"));case 10:if(!(l=e.sent).ok){e.next=25;break}return e.next=14,l.json();case 14:o=e.sent,c=o.results,s=0;case 17:if(!(s<c.length)){e.next=25;break}if("Trailer"!==c[s].type){e.next=22;break}return u=c[s].key,i.trailer="https://www.youtube.com/embed/".concat(u),e.abrupt("break",25);case 22:s++,e.next=17;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(7),console.log(e.t0);case 30:a[n]=i;case 31:n++,e.next=2;break;case 34:return e.abrupt("return",a);case 35:case"end":return e.stop()}var d}),e,null,[[7,27]])})));return function(t){return e.apply(this,arguments)}}(),Ee=function(){var e=ce(),t=Object(d.a)(e,2),a=t[0],i=t[1],l=a.movies,c=a.likedMovies,s=a.dislikedMovies,u=Object(n.useState)(""),m=Object(d.a)(u,2),v=m[0],p=m[1],f=Object(o.useMutation)(U),h=Object(d.a)(f,2),b=h[0],g=h[1].addMovieError,k=Object(o.useMutation)(V),y=Object(d.a)(k,1)[0],w=Object(o.useMutation)(R),j=Object(d.a)(w,1)[0],_=Object(o.useQuery)(de),x=_.loading,N=_.data;Object(n.useEffect)((function(){c.length||s.length||(N&&N.me?!N.me.likedMovies.length&&N.me.dislikedMovies.length||(console.log("Online, using data from server to update movie preferences"),i({type:"UPDATE_MOVIE_PREFERENCES",likedMovies:N.me.likedMovies,dislikedMovies:N.me.dislikedMovies})):x||me("likedMovies","get").then((function(e){me("dislikedMovies","get").then((function(t){(t.length||e.length)&&(console.log("Offline, using data from idb to update movie preferences"),i({type:"UPDATE_MOVIE_PREFERENCES",likedMovies:e,dislikedMovies:t}))}))})))}),[N,x,c,s,i]),Object(n.useEffect)((function(){if(l.length&&""===v){console.log("There are movies, but no movieIndex. Setting movieIndex");for(var e=function(e){var t=c.some((function(t){return t._id===l[e]._id})),a=s.some((function(t){return t._id===l[e]._id}));if(!t&&!a&&l[e].trailer)return p(e),"break"},t=0;t<l.length;t++){if("break"===e(t))break}}}),[p,s,c,l,v]),Object(n.useEffect)((function(){if(!l.length)try{console.log("Pinging TMDB API to get trending movies"),(e="week",fetch("https://api.themoviedb.org/3/trending/movie/".concat(e,"?api_key=d64da0474db9594724886e71c0d202f1"))).then((function(e){if(!e.ok)throw new Error("Couldn't load trending movies");e.json().then(function(){var e=Object(M.a)(O.a.mark((function e(t){var a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.results,e.next=3,fe(a);case 3:e.sent.forEach(function(){var e=Object(M.a)(O.a.mark((function e(t){var a,n,r,l,o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b({variables:{input:t}});case 2:if(a=e.sent,!g){e.next=5;break}throw new Error("Couldn't add movie");case 5:return e.next=7,a;case 7:return n=e.sent,r=n.data,e.next=11,r;case 11:l=e.sent,o=l.addMovie,i({type:"ADD_TO_MOVIES",movie:o}),me("movies","put",o);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}))}catch(t){console.log("Couldn't get data from TMDB API. Using IDB to display movies."),me("movies","get").then((function(e){e.length&&(console.log("Using IDB to get trending movies"),i({type:"UPDATE_MOVIES",movies:e}))}))}var e}),[l,N,i,x,b,g]);var I=function(){var e=Object(M.a)(O.a.mark((function e(){var t,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l.length){e.next=12;break}t=function(e){var t=c.some((function(t){return t._id===l[e]._id})),a=s.some((function(t){return t._id===l[e]._id}));if(!t&&!a&&l[e].trailer)return p(e),"break"},a=v+1;case 3:if(!(a<l.length)){e.next=10;break}if("break"!==t(a)){e.next=7;break}return e.abrupt("break",10);case 7:a++,e.next=3;break;case 10:e.next=13;break;case 12:p("");case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,{fluid:!0,className:"text-light bg-dark"},r.a.createElement(W.a,null,r.a.createElement("h1",null,"Welcome to FANTINDER!"),E.loggedIn()?r.a.createElement("h4",null,"Click thumbs up to like and save a movie, thumbs down to pass."):r.a.createElement("h4",null,"Check out our recommended movies below."))),r.a.createElement(W.a,null,x?r.a.createElement("h2",null,"Loading...."):null,l.length?r.a.createElement(se,{movie:l[v],displayTrailer:!0,displaySkip:!0,likeMovieHandler:function(e){j({variables:{movieId:e._id}}).then((function(t){t?(i({type:"ADD_TO_LIKED_MOVIES",movie:e}),me("likedMovies","put",e),me("dislikedMovies","delete",e),I()):console.error("Couldn't like the movie!")})).catch((function(e){return console.error(e)}))},dislikeMovieHandler:function(e){y({variables:{movieId:e._id}}).then((function(t){t?(i({type:"ADD_TO_DISLIKED_MOVIES",movie:e}),me("likedMovies","delete",e),me("dislikedMovies","put",e),I()):console.error("Couldn't dislike the movie!")})).catch((function(e){return console.error(e)}))},skipMovieHandler:I}):null))},he=a(162),be=function(){var e=ce(),t=Object(d.a)(e,2),a=t[0],i=t[1],l=a.likedMovies,c=a.dislikedMovies,s=Object(n.useState)(!0),u=Object(d.a)(s,2),m=u[0],v=u[1],p=Object(n.useState)(""),f=Object(d.a)(p,2),E=f[0],h=f[1],b=Object(n.useState)([]),g=Object(d.a)(b,2),k=g[0],y=g[1],w=Object(n.useState)(!1),j=Object(d.a)(w,2),x=j[0],I=j[1],S=Object(o.useMutation)(U),C=Object(d.a)(S,2),D=C[0],T=C[1].addMovieError,P=Object(o.useMutation)(V),A=Object(d.a)(P,1)[0],L=Object(o.useMutation)(R),F=Object(d.a)(L,1)[0],q=Object(o.useQuery)(de),K=q.loading,$=q.data;Object(n.useEffect)((function(){l.length||c.length||($&&$.me?!$.me.likedMovies.length&&$.me.dislikedMovies.length||(console.log("Online, using data from server to update movie preferences"),i({type:"UPDATE_MOVIE_PREFERENCES",likedMovies:$.me.likedMovies,dislikedMovies:$.me.dislikedMovies})):K||me("likedMovies","get").then((function(e){me("dislikedMovies","get").then((function(t){(t.length||e.length)&&(console.log("Offline, using data from idb to update movie preferences"),i({type:"UPDATE_MOVIE_PREFERENCES",likedMovies:e,dislikedMovies:t}))}))})))}),[$,K,l,c,i]);var B=function(){var e=Object(M.a)(O.a.mark((function e(t){var a,n,r,i,l,o,c,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),y([]),I(!0),E){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,fetch("https://api.themoviedb.org/3/search/movie?api_key=d64da0474db9594724886e71c0d202f1&query=".concat(E));case 7:if((a=e.sent).ok){e.next=10;break}throw new Error("Couldn't search for movies");case 10:return e.next=12,a.json();case 12:if(n=e.sent,0!==(r=n.results).length){e.next=18;break}return v(!1),I(!1),e.abrupt("return");case 18:return e.next=20,fe(r);case 20:i=e.sent,l=[],o=0;case 23:if(!(o<i.length)){e.next=32;break}return e.next=26,D({variables:{input:i[o]}});case 26:c=e.sent,s=c.data,T||l.push(s.addMovie);case 29:o++,e.next=23;break;case 32:y(l),I(!1),v(!0);case 36:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(e){F({variables:{movieId:e._id}}).then((function(t){t?(i({type:"ADD_TO_LIKED_MOVIES",movie:e}),me("likedMovies","put",e),me("dislikedMovies","delete",e)):console.error("Couldn't like the movie!")})).catch((function(e){return console.error(e)}))},Y=function(e){A({variables:{movieId:e._id}}).then((function(t){t?(i({type:"ADD_TO_DISLIKED_MOVIES",movie:e}),me("likedMovies","delete",e),me("dislikedMovies","put",e)):console.error("Couldn't dislike the movie!")})).catch((function(e){return console.error(e)}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,{fluid:!0,className:"text-light bg-dark"},r.a.createElement(W.a,null,r.a.createElement(_.a,{onSubmit:function(e){return B(e,E)}},r.a.createElement(_.a.Label,{className:"h3"},"Find your favorite movies"),r.a.createElement(_.a.Control,{name:"searchInput",value:E,onChange:function(e){return h(e.target.value)},type:"text",placeholder:"The Lord of the Rings"}),r.a.createElement(N.a,{type:"submit",className:"mt-2"},"Search")))),r.a.createElement(W.a,null,x||m?r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",{className:"results-heading"},k.length>0&&"Viewing ".concat(k.length," results:")),r.a.createElement(he.a,null,null===k||void 0===k?void 0:k.map((function(e){return r.a.createElement(se,{key:e._id,movie:e,displayTrailer:!0,likeMovieHandler:G,dislikeMovieHandler:Y})})))):r.a.createElement("h2",{className:"results-heading"},"No movies found! Please try another search.")))},ge=function(){var e=ce(),t=Object(d.a)(e,2),a=t[0],i=t[1],l=a.likedMovies,c=a.dislikedMovies,s=Object(o.useMutation)(V),u=Object(d.a)(s,1)[0],m=Object(o.useMutation)(R),v=Object(d.a)(m,1)[0],p=Object(o.useQuery)(de),f=p.loading,E=p.data;Object(n.useEffect)((function(){l.length||c.length||(E&&E.me?!E.me.likedMovies.length&&E.me.dislikedMovies.length||(console.log("Online, using data from server to update movie preferences"),i({type:"UPDATE_MOVIE_PREFERENCES",likedMovies:E.me.likedMovies,dislikedMovies:E.me.dislikedMovies})):f||me("likedMovies","get").then((function(e){me("dislikedMovies","get").then((function(t){(t.length||e.length)&&(console.log("Offline, using data from idb to update movie preferences"),i({type:"UPDATE_MOVIE_PREFERENCES",likedMovies:e,dislikedMovies:t}))}))})))}),[E,f,l,c,i]);var h=function(e){v({variables:{movieId:e._id}}).then((function(t){t?(i({type:"ADD_TO_LIKED_MOVIES",movie:e}),me("likedMovies","put",e),me("dislikedMovies","delete",e)):console.error("Couldn't like the movie!")})).catch((function(e){return console.error(e)}))},b=function(e){u({variables:{movieId:e._id}}).then((function(t){t?(i({type:"ADD_TO_DISLIKED_MOVIES",movie:e}),me("likedMovies","delete",e),me("dislikedMovies","put",e)):console.error("Couldn't dislike the movie!")})).catch((function(e){return console.error(e)}))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(H.a,{fluid:!0,className:"text-light bg-dark"},r.a.createElement(W.a,null,r.a.createElement("h1",null,"My Movies"))),r.a.createElement(W.a,null,r.a.createElement("h2",{className:"pb-5"},(null===l||void 0===l?void 0:l.length)>0?"Displaying ".concat(l.length," saved ").concat(1===l.length?"movie":"movies",":"):"You have no saved movies!"),r.a.createElement(he.a,null,(null===l||void 0===l?void 0:l.length)?l.map((function(e){return r.a.createElement(se,{key:e._id,movie:e,displayTrailer:!0,likeMovieHandler:h,dislikeMovieHandler:b})})):null)))},ke=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(W.a,{fluid:!0,className:"text-light page-footer d-flex"},r.a.createElement(W.a,null,r.a.createElement("h5",{className:"pt-4"},"Contact Us"),r.a.createElement("div",{className:"d-lg-flex pb-4 justify-content-between"},r.a.createElement("ul",{className:"no-bullets"},r.a.createElement("li",null,r.a.createElement("h6",null,"Anita Ganti")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"https://anitapeppercorn.github.io/react-portfolio/#/about"},r.a.createElement("span",null,r.a.createElement("i",{className:"far fa-folder pr-3"})),"https://anitapeppercorn.github.io/react-portfolio")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"mailto:anita_r_ganti@yahoo.com"},r.a.createElement("span",null,r.a.createElement("i",{className:"far fa-envelope pr-3"})),"anita_r_ganti@yahoo.com")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"https://github.com/anitapeppercorn"},r.a.createElement("span",null,r.a.createElement("i",{className:"fab fa-github pr-3"})),"anitapeppercorn")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"https://www.linkedin.com/in/anita-ganti-9380961/"},r.a.createElement("span",null,r.a.createElement("i",{className:"fab fa-linkedin pr-3"})),"anita-ganti-9380961"))),r.a.createElement("ul",{className:"no-bullets"},r.a.createElement("li",null,r.a.createElement("h6",null,"Priya Ravi")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"https://priyaravi23.github.io/react-portfolio/#/about"},r.a.createElement("span",null,r.a.createElement("i",{className:"far fa-folder pr-3"})),"https://priyaravi23.github.io/react-portfolio/")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"mailto:priyaravi23@gmail.com"},r.a.createElement("span",null,r.a.createElement("i",{className:"far fa-envelope pr-3"})),"priyaravi23@gmail.com")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"https://github.com/priyaravi23"},r.a.createElement("span",null,r.a.createElement("i",{className:"fab fa-github pr-3"})),"priyaravi23")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"https://www.linkedin.com/in/priya-ravi-4508437b/"},r.a.createElement("span",null,r.a.createElement("i",{className:"fab fa-linkedin pr-3"})),"priya-ravi-4508437b"))),r.a.createElement("ul",{className:"no-bullets"},r.a.createElement("li",null,r.a.createElement("h6",null,"Vanessa Lane")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"https://vanessalane.herokuapp.com"},r.a.createElement("span",null,r.a.createElement("i",{className:"far fa-folder pr-3"})),"https://vanessalane.herokuapp.com")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"mailto:vlane0593@gmail.com"},r.a.createElement("span",null,r.a.createElement("i",{className:"far fa-envelope pr-3"})),"vlane0593@gmail.com")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"https://github.com/vanessalane"},r.a.createElement("span",null,r.a.createElement("i",{className:"fab fa-github pr-3"})),"vanessalane")),r.a.createElement("li",null,r.a.createElement("a",{className:"footer-link",href:"https://www.linkedin.com/in/vanessa-lane/"},r.a.createElement("span",null,r.a.createElement("i",{className:"fab fa-linkedin pr-3"})),"vanessa-lane")))),r.a.createElement("div",{className:"d-flex justify-content-between"},r.a.createElement("p",null,"\xa9 2020"),r.a.createElement("p",null,r.a.createElement("a",{className:"footer-link",href:"https://github.com/anitapeppercorn/FANTINDER"},r.a.createElement("i",{className:"fab fa-github pr-3"}),"Visit the GitHub Repo"))))))},ye=a(123),Oe=a(124),Me=function(){var e=Object(M.a)(O.a.mark((function e(t){var a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.quantity,e.abrupt("return",fetch("/create-checkout-session",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:a})}).then((function(e){return e.json()})));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),we=function(e){var t,a=e.amount,n=e.currency,r=e.quantity,i=new Intl.NumberFormat("en-US",{style:"currency",currency:n,currencyDisplay:"symbol"}),l=i.formatToParts(a),o=!0,c=Object(ye.a)(l);try{for(c.s();!(t=c.n()).done;){"decimal"===t.value.type&&(o=!1)}}catch(u){c.e(u)}finally{c.f()}var s=(r*(a=o?a:a/100)).toFixed(2);return i.format(s)};function je(e,t){switch(t.type){case"useEffectUpdate":return Object(j.a)(Object(j.a)(Object(j.a)({},e),t.payload),{},{price:we({amount:t.payload.unitAmount,currency:t.payload.currency,quantity:e.quantity})});case"increment":return Object(j.a)(Object(j.a)({},e),{},{quantity:e.quantity+1,price:we({amount:e.unitAmount,currency:e.currency,quantity:e.quantity+1})});case"decrement":return Object(j.a)(Object(j.a)({},e),{},{quantity:e.quantity-1,price:we({amount:e.unitAmount,currency:e.currency,quantity:e.quantity-1})});case"setLoading":return Object(j.a)(Object(j.a)({},e),{},{loading:t.payload.loading});case"setError":return Object(j.a)(Object(j.a)({},e),{},{error:t.payload.error});default:throw new Error}}var _e=function(){var e,t=Object(n.useReducer)(je,{quantity:1,price:null,loading:!1,error:null,stripe:null}),a=Object(d.a)(t,2),i=a[0],l=a[1];Object(n.useEffect)((function(){function e(){return(e=Object(M.a)(O.a.mark((function e(){var t,a,n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/config").then((function(e){return e.json()}));case 2:return t=e.sent,a=t.publicKey,n=t.unitAmount,r=t.currency,e.t0=l,e.t1=n,e.t2=r,e.next=11,Object(Oe.a)(a);case 11:e.t3=e.sent,e.t4={unitAmount:e.t1,currency:e.t2,stripe:e.t3},e.t5={type:"useEffectUpdate",payload:e.t4},(0,e.t0)(e.t5);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var o=function(){var e=Object(M.a)(O.a.mark((function e(t){var a,n,r,o;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l({type:"setLoading",payload:{loading:!0}}),e.next=3,Me({quantity:i.quantity});case 3:return a=e.sent,n=a.sessionId,e.next=7,i.stripe.redirectToCheckout({sessionId:n});case 7:r=e.sent,(o=r.error)&&(l({type:"setError",payload:{error:o}}),l({type:"setLoading",payload:{loading:!1}}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"sr-root"},r.a.createElement("div",{className:"sr-main"},r.a.createElement("header",{className:"sr-header"},r.a.createElement("div",{className:"sr-header__logo"})),r.a.createElement("section",{className:"container"},r.a.createElement("div",null,r.a.createElement("h1",null,"Thank you for considering a donation"),r.a.createElement("h4",null,"Your donation will be used to plant trees"),r.a.createElement("div",{className:"pasha-image"},r.a.createElement("img",{alt:"NASA",src:"https://eoimages.gsfc.nasa.gov/images/imagerecords/147000/147439/vlmsf_se1_2018_lrg.jpg",width:"140",height:"160"}))),r.a.createElement("div",{className:"quantity-setter"},r.a.createElement("button",{className:"increment-btn",disabled:1===i.quantity,onClick:function(){return l({type:"decrement"})}},"-"),r.a.createElement("input",{type:"number",id:"quantity-input",min:"1",max:"10",value:i.quantity,readOnly:!0}),r.a.createElement("button",{className:"increment-btn",disabled:10===i.quantity,onClick:function(){return l({type:"increment"})}},"+")),r.a.createElement("p",{className:"sr-legal-text"},"Number of units in one donation (max 10)"),r.a.createElement("button",{role:"link",onClick:o,disabled:!i.stripe||i.loading},i.loading||!i.price?"Loading...":"Buy for ".concat(i.price)),r.a.createElement("div",{className:"sr-field-error"},null===(e=i.error)||void 0===e?void 0:e.message))))},xe=a(125),Ne=a.n(xe),Ie=a(126),Se=a.n(Ie),Ce=(a(152),new c.a({request:function(e){var t=localStorage.getItem("id_token");e.setContext({headers:{authorization:t?"Bearer ".concat(t):""}})},uri:"/graphql"}));var De=function(){return r.a.createElement(o.ApolloProvider,{client:Ce},r.a.createElement(s.a,null,r.a.createElement(oe,null,r.a.createElement("div",{className:"app-container"},r.a.createElement("div",{className:"app-content"},r.a.createElement(B,null),r.a.createElement(u.c,null,r.a.createElement(u.a,{exact:!0,path:"/",component:Ee}),r.a.createElement(u.a,{exact:!0,path:"/search",component:be}),r.a.createElement(u.a,{exact:!0,path:"/success",component:Ne.a}),r.a.createElement(u.a,{exact:!0,path:"/canceled",component:Se.a}),r.a.createElement(u.a,{exact:!0,path:"/checkout",component:_e}),r.a.createElement(u.a,{exact:!0,path:"/saved",component:ge}),r.a.createElement(u.a,{render:function(){return r.a.createElement("h1",{className:"display-2"},"Wrong page!")}})))),r.a.createElement(ke,null))))},Te=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Pe(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(De,null)),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");Te?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Pe(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Pe(t,e)}))}}()}},[[131,1,2]]]);
//# sourceMappingURL=main.3f4c979f.chunk.js.map